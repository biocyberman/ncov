# Define locations for which builds should be created.
# For each build we specify a subsampling scheme via an explicit key.
# If the name of the focal geography differs from the build name this needs to
# be specified explicity as geographic_name. In addition, we require the
# geographic scale the build focuses on. Together name and scale serve a look-up
# in the geo_hierarchy to define region, country, division, etc
builds:
  Test:
    subsampling_scheme: test_sub
    geographic_scale: division
    region: Europe
    country: Denmark
    auspice_config: "my_profiles/denmark/auspice_config_denmark.json"

  Denmark_Light:
    subsampling_scheme: denmark_light
    geographic_scale: division
    region: Europe
    country: Denmark
    auspice_config: "my_profiles/denmark/auspice_config_denmark.json"

  Denmark_Full:
    subsampling_scheme: denmark_full
    geographic_scale: division
    region: Europe
    country: Denmark
    auspice_config: "my_profiles/denmark/auspice_config_denmark.json"

  Global:
    subsampling_scheme: global_subsample
    geographic_scale: country
    region: Europe
    country: Denmark
    auspice_config: "my_profiles/denmark/auspice_config_denmark.json"
    description: "my_profiles/denmark/description_global.md"

subsampling:
  # Default subsampling logic for countries
  denmark_light:
    # Focal samples for country
    last_month:
      group_by: "division year month"
      seq_per_group: 9000
      exclude: "--exclude-where 'country!={country}'"
      min_date: numeric_date(date.today() - timedelta(days=30))

    earlier:
      group_by: "division year month"
      seq_per_group: 20
      exclude: "--exclude-where 'country!={country}'"
      max_date: numeric_date(date.today() - timedelta(days=30))
      priorities:
        type: "proximity"
        focus: "last_month"

  denmark_full:
    # Focal samples for country
    country:
      group_by: "division year month"
      seq_per_group: 9000
      exclude: "--exclude-where 'country!={country}'"

  global_subsample:
    # Focal samples for country
    last_month:
      group_by: "division year month"
      seq_per_group: 9000
      exclude: "--exclude-where 'country!={country}'"
      min_date: numeric_date(date.today() - timedelta(days=30))
    earlier:
      group_by: "division year month"
      seq_per_group: 20
      exclude: "--exclude-where 'country!={country}'"
      max_date: numeric_date(date.today() - timedelta(days=30))
      priorities:
        type: "proximity"
        focus: "last_month"
    # Contextual samples from country's region
    region:
      group_by: "country year month"
      seq_per_group: 20
      exclude: "--exclude-where 'country={country}' 'region!={region}'"
      priorities:
        type: "proximity"
        focus: "last_month"
    # Contextual samples from the rest of the world,
    # excluding the current region to avoid resampling.
    global:
      group_by: "country year month"
      seq_per_group: 10
      exclude: "--exclude-where 'region={region}'"
      priorities:
        type: "proximity"
        focus: "last_month"

  test_sub:
    # Focal samples for country
    last_month:
      group_by: "division year month"
      seq_per_group: 50
      exclude: "--exclude-where 'country!={country}'"
      min_date: numeric_date(date.today() - timedelta(days=30))
    # Contextual samples from country's region
    earlier:
      group_by: "division year month"
      seq_per_group: 10
      exclude: "--exclude-where 'country!={country}'"
      max_date: numeric_date(date.today() - timedelta(days=30))
      priorities:
        type: "proximity"
        focus: "last_month"
    # Contextual samples from country's region
    region:
      group_by: "country year month"
      seq_per_group: 10
      exclude: "--exclude-where 'country={country}' 'region!={region}'"
      priorities:
        type: "proximity"
        focus: "last_month"
    # Contextual samples from the rest of the world,
    # excluding the current region to avoid resampling.
    global:
      group_by: "country year month"
      seq_per_group: 5
      exclude: "--exclude-where 'region={region}'"
      priorities:
        type: "proximity"
        focus: "last_month"


  # Default subsampling logic for divisions
  municipality:
    # Focal samples for division
    division:
      group_by: "year month"
      seq_per_group: 3000
      exclude: "--exclude-where 'region!={region}' 'country!={country}' 'division!={division}'"
    # Contextual samples from division's country
    country:
      group_by: "division year month"
      seq_per_group: 20
      exclude: "--exclude-where 'region!={region}' 'country!={country}' 'division={division}'"
      priorities:
        type: "proximity"
        focus: "division"
    # Contextual samples from division's region
    region:
      group_by: "country year month"
      seq_per_group: 10
      exclude: "--exclude-where 'region!={region}' 'country={country}'"
      priorities:
        type: "proximity"
        focus: "division"
    # Contextual samples from the rest of the world, excluding the current
    # division to avoid resampling.
    global:
      group_by: "country year month"
      seq_per_group: 5
      exclude: "--exclude-where 'region={region}'"
      priorities:
        type: "proximity"
        focus: "division"
files:
  colors: "my_profiles/denmark/colors.tsv"
  ordering: "my_profiles/denmark/color_ordering.tsv"
  lat_longs: "my_profiles/denmark/lat_longs.tsv"
  description: "my_profiles/denmark/description.md"
